<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VISUALISEUR TECHNIQUE | CR√âTEIL - VAL DE MARNE</title>
    <link href="https://fonts.googleapis.com/css2?family=Segoe+UI:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        /* --- CHARTE GRAPHIQUE --- */
        :root { 
            --blue-corp: #004481; /* Bleu Institutionnel */
            --gold-corp: #cfa052; /* Dor√© Prestige */
            --grey-bg: #eef2f5;
        }

        /* RESET ET STRUCTURE BLOQU√âE */
        * { box-sizing: border-box; }
        body { 
            font-family: 'Segoe UI', sans-serif; 
            margin: 0; 
            background: var(--grey-bg); 
            height: 100vh; 
            display: flex; 
            flex-direction: column; 
            overflow: hidden; /* Z√©ro scroll sur la page globale */
        }

        /* --- EN-T√äTE FIXE --- */
        header { 
            background: white; 
            height: 90px; 
            padding: 0 30px; 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            border-bottom: 5px solid var(--gold-corp);
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            flex-shrink: 0;
            z-index: 100;
        }

        /* LOGO & TITRE */
        .brand { display: flex; align-items: center; gap: 20px; }
        .logo-img { height: 70px; width: auto; } /* Taille ajust√©e pour ton fichier */
        .app-details { display: flex; flex-direction: column; }
        .app-title { 
            font-size: 22px; font-weight: 800; color: var(--blue-corp); 
            text-transform: uppercase; letter-spacing: 0.5px;
        }
        .app-subtitle { font-size: 14px; color: #666; font-weight: 600; }

        /* BOUTONS D'ACTION */
        .actions { display: flex; gap: 15px; }
        .btn { 
            padding: 12px 25px; border: none; border-radius: 6px; 
            font-weight: 700; cursor: pointer; font-size: 15px; 
            transition: all 0.2s; display: flex; align-items: center; gap: 10px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }
        .btn-import { background: var(--blue-corp); color: white; }
        .btn-import:hover { background: #003366; transform: translateY(-2px); }
        .btn-save { background: #27ae60; color: white; }
        .btn-save:hover { background: #219150; transform: translateY(-2px); }

        /* --- INTERFACE PRINCIPALE --- */
        #workspace { display: flex; flex: 1; overflow: hidden; }

        /* SIDEBAR (LISTE BATIMENTS) */
        #sidebar { 
            width: 300px; background: white; 
            border-right: 1px solid #ddd; 
            display: flex; flex-direction: column;
            flex-shrink: 0;
        }
        .sidebar-header {
            padding: 20px; background: var(--blue-corp); color: white;
            font-weight: bold; text-align: center; font-size: 16px;
            border-bottom: 4px solid var(--gold-corp);
        }
        #bat-list { overflow-y: auto; flex: 1; }
        .bat-item { 
            padding: 18px 25px; border-bottom: 1px solid #f0f0f0; 
            cursor: pointer; color: #333; font-size: 15px; font-weight: 600;
            transition: background 0.2s;
        }
        .bat-item:hover { background: #f4f4f4; color: var(--blue-corp); }
        .bat-item.active { 
            background: var(--blue-corp); color: white; 
            border-left: 6px solid var(--gold-corp);
        }

        /* ZONE VISUALISATION (SCROLLABLE) */
        #viewer { 
            flex: 1; overflow-y: auto; padding: 40px; 
            display: flex; flex-direction: column; align-items: center; 
            scroll-behavior: smooth;
            background: #eef2f5;
        }

        /* --- LA CASE V9.2 "TITANIUM" (Invincible) --- */
        .card {
            display: flex; 
            flex-direction: row; /* Force l'affichage c√¥te √† c√¥te */
            width: 100%; max-width: 1600px; /* Largeur max grand √©cran */
            height: 550px; /* HAUTEUR FIXE : RIEN NE D√âPASSE */
            background: white; 
            margin-bottom: 50px; 
            border: 1px solid #dcdcdc; 
            box-shadow: 0 10px 25px rgba(0,0,0,0.08);
            border-radius: 8px; overflow: hidden;
        }

        /* GAUCHE : IMAGE (50%) */
        .card-img {
            width: 50%; height: 100%;
            background: #000; /* Fond noir pour contraste photo */
            display: flex; align-items: center; justify-content: center;
            border-right: 5px solid var(--gold-corp);
            flex-shrink: 0;
        }
        .card-img img {
            max-width: 100%; max-height: 100%; 
            object-fit: contain; /* L'image est enti√®re, jamais coup√©e */
        }

        /* DROITE : TEXTE (50%) */
        .card-txt {
            width: 50%; height: 100%;
            padding: 40px;
            font-size: 20px; /* Police tr√®s lisible */
            line-height: 1.6;
            color: #2c3e50;
            background: white;
            overflow-y: auto; /* Scroll interne uniquement ici */
            font-family: 'Segoe UI', sans-serif;
            text-align: justify;
        }
        .card-txt:focus { background: #fffbe6; outline: none; } /* Focus √©dition */
        
        /* TITRES DE SECTION */
        .bat-title {
            width: 100%; max-width: 1600px;
            color: var(--blue-corp);
            border-bottom: 3px solid var(--gold-corp);
            padding-bottom: 10px; margin-bottom: 30px;
            font-size: 28px; font-weight: 800; text-transform: uppercase;
        }
    </style>
</head>
<body>

<input type="file" id="fileInput" style="display:none" onchange="importerFichier(this)">

<header>
    <div class="brand">
        <img src="Logo_Cr√©teil_Val_Marne.svg.png" class="logo-img" alt="Logo Cr√©teil Val de Marne" onerror="this.style.display='none'; alert('‚ö†Ô∏è Pense √† ajouter le fichier image Logo_Cr√©teil_Val_Marne.svg.png dans ton GitHub !')">
        
        <div class="app-details">
            <div class="app-title">STUDIO TECHNIQUE</div>
            <div class="app-subtitle">Visualisation & R√©paration V9.2</div>
        </div>
    </div>
    <div class="actions">
        <button class="btn btn-import" onclick="document.getElementById('fileInput').click()">üìÇ IMPORTER MON FICHIER BUGG√â</button>
        <button class="btn btn-save" onclick="sauvegarder()">üíæ T√âL√âCHARGER PROPRE</button>
    </div>
</header>

<div id="workspace">
    <div id="sidebar">
        <div class="sidebar-header">ZONES DU B√ÇTIMENT</div>
        <div id="bat-list"></div>
    </div>
    <div id="viewer"></div>
</div>

<script>
    let DATA = {};

    // --- 1. SIMULATION MASSIVE (ACTIVE PAR D√âFAUT) ---
    function initSimulation() {
        // G√©n√©ration de 15 B√¢timents avec ~200 photos au total
        const lorem = "1. Fissuration traversante constat√©e sur le voile b√©ton (voir photo).\n2. Reprise d'√©tanch√©it√© n√©cessaire en partie basse.\n3. Traces d'humidit√© actives, infiltration probable depuis la toiture terrasse.\n4. Peinture √©caill√©e sur l'ensemble du support.\n5. Menuiserie : jeu important dans les ouvrants, remplacement pr√©conis√©.\n6. Sol : usure normale, pas de d√©collement des dalles.\n7. √âlectricit√© : le tableau divisionnaire semble conforme mais v√©tuste.\n8. Conclusion : Intervention de priorit√© 2 √† pr√©voir au budget 2026.\n9. Note compl√©mentaire : Acc√®s difficile, pr√©voir √©chafaudage.";
        
        for (let i = 1; i <= 15; i++) {
            let nom = `ZONE ${i} - AILE ${String.fromCharCode(64+i)}`;
            let photos = [];
            // 14 photos par b√¢timent = 210 photos
            for (let j = 1; j <= 14; j++) {
                photos.push({
                    src: `https://via.placeholder.com/800x600/004481/FFFFFF?text=PHOTO+${j}+-+${nom}`,
                    txt: `PHOTO N¬∞${j} / 210\nLIEU : ${nom}\n\n${lorem}`
                });
            }
            DATA[nom] = photos;
        }
        renderSidebar();
    }

    // --- 2. AFFICHAGE (MOTEUR V9.2) ---
    function renderSidebar() {
        const list = document.getElementById('bat-list');
        list.innerHTML = '';
        const bats = Object.keys(DATA);
        
        bats.forEach((bat, idx) => {
            const div = document.createElement('div');
            div.className = 'bat-item';
            div.innerText = `üè¢ ${bat} (${DATA[bat].length})`;
            div.onclick = () => {
                document.querySelectorAll('.bat-item').forEach(b => b.classList.remove('active'));
                div.classList.add('active');
                renderPhotos(bat);
            };
            list.appendChild(div);
            if(idx === 0) div.click();
        });
    }

    function renderPhotos(batName) {
        const viewer = document.getElementById('viewer');
        viewer.innerHTML = `<h2 class="bat-title">${batName}</h2>`;
        
        DATA[batName].forEach(photo => {
            const card = document.createElement('div');
            card.className = 'card';
            card.innerHTML = `
                <div class="card-img">
                    <img src="${photo.src}" loading="lazy">
                </div>
                <div class="card-txt" contenteditable="true">
                    ${photo.txt}
                </div>
            `;
            // Sauvegarde temps r√©el
            card.querySelector('.card-txt').addEventListener('input', (e) => {
                photo.txt = e.target.innerText;
            });
            viewer.appendChild(card);
        });
    }

    // --- 3. IMPORTATION (R√âPARATION) ---
    function importerFichier(input) {
        if (input.files.length === 0) return;
        
        const reader = new FileReader();
        reader.onload = function(e) {
            const content = e.target.result;
            // Regex de combat pour trouver le JSON cach√©
            const match = content.match(/\{"[\s\S]*"\}/g);
            
            if (match) {
                try {
                    // On prend le bloc le plus long (c'est tes donn√©es)
                    const cleanJson = match.sort((a,b) => b.length - a.length)[0];
                    DATA = JSON.parse(cleanJson);
                    renderSidebar();
                    alert("‚úÖ FICHIER R√âPAR√â ! Tes photos sont charg√©es.");
                } catch (err) {
                    alert("‚ö†Ô∏è Le fichier est trop ab√Æm√©.");
                }
            } else {
                alert("‚ùå Aucune donn√©e photo trouv√©e.");
            }
        };
        reader.readAsText(input.files[0]);
    }

    // --- 4. SAUVEGARDE (EXPORT PROPRE) ---
    function sauvegarder() {
        const jsonStr = JSON.stringify(DATA);
        let htmlContent = document.documentElement.outerHTML;
        
        // On remplace la simulation par les vraies donn√©es dans le fichier t√©l√©charg√©
        htmlContent = htmlContent.replace('initSimulation();', '// Simulation d√©sactiv√©e');
        htmlContent = htmlContent.replace('let DATA = {};', `let DATA = ${jsonStr};`);
        htmlContent = htmlContent.replace('</script>', 'renderSidebar(); </script>');

        const blob = new Blob([htmlContent], {type: 'text/html'});
        const a = document.createElement('a');
        a.href = URL.createObjectURL(blob);
        a.download = 'RAPPORT_VAL_DE_MARNE_CLEAN.html';
        a.click();
    }

    // D√©marrage
    initSimulation();
</script>
</body>
</html>
